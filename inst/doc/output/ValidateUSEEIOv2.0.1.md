---
title: "Validating USEEIOv2.0.1 Model"
date: "2021-11-05"
output:
  html_document:
    keep_md: yes
editor_options: 
  chunk_output_type: console
---

This document presents validation results of USEEIOv2.0.1 model.

### Build and Calculate Model

```r
model <- buildModel(modelname)
#> 2021-11-05 13:54:36 INFO::Begin model initialization...
#> 2021-11-05 13:54:36 INFO::Initializing IO tables...
#> 2021-11-05 13:54:36 INFO::Initializing Gross Output tables...
#> 2021-11-05 13:54:37 INFO::Initializing Chain Price Index tables...
#> 2021-11-05 13:54:38 INFO::Loading disaggregation specification file for WasteDisaggregationDetail...
#> 2021-11-05 13:54:38 INFO::Initializing Disaggregation of IO tables...
#> 2021-11-05 13:54:39 INFO::Initializing model satellite tables...
#> 2021-11-05 13:54:39 INFO::Loading Water withdrawals flows from DataCommons...
#> 2021-11-05 13:54:39 INFO::Loading Criteria and Hazardous Air Emissions flows from DataCommons...
#> 2021-11-05 13:54:45 INFO::Loading Point source industrial releases to ground flows from DataCommons...
#> 2021-11-05 13:54:45 INFO::Loading Point source releases to water flows from DataCommons...
#> 2021-11-05 13:54:46 INFO::Loading Greenhouse Gases flows from DataCommons...
#> 2021-11-05 13:54:46 INFO::Loading Land use flows from DataCommons...
#> 2021-11-05 13:54:46 INFO::Loading Mineral extraction flows from DataCommons...
#> 2021-11-05 13:54:46 INFO::Loading Energy extraction flows from DataCommons...
#> 2021-11-05 13:54:46 WARNING::No data found for disaggregation of ENERGY for 562000/US - applying default allocation
#> 2021-11-05 13:54:46 INFO::Loading Nitrogen and Phosphorus Releases from Agriculture flows from DataCommons...
#> 2021-11-05 13:54:46 INFO::Loading Pesticide releases flows from DataCommons...
#> 2021-11-05 13:54:46 INFO::Loading Commercial non-hazardous waste excluding construction activities flows from DataCommons...
#> 2021-11-05 13:54:46 WARNING::No data found for disaggregation of CNHW for 562000/US - applying default allocation
#> 2021-11-05 13:54:47 INFO::Loading Commercial non-hazardous waste from construction activities flows from DataCommons...
#> 2021-11-05 13:54:47 INFO::Loading Commercial RCRA-defined hazardous waste flows from DataCommons...
#> 2021-11-05 13:54:49 INFO::Loading Employment flows from DataCommons...
#> 2021-11-05 13:54:49 INFO::Generating Value Added flows...
#> 2021-11-05 13:54:49 INFO::Initializing model indicators...
#> 2021-11-05 13:54:49 INFO::Getting Greenhouse Gases indicator from DataCommons...
#> 2021-11-05 13:54:49 INFO::Getting Acidification Potential indicator from DataCommons...
#> 2021-11-05 13:54:49 INFO::Getting Eutrophication Potential indicator from DataCommons...
#> 2021-11-05 13:54:49 INFO::Getting Freshwater Ecotoxicity Potential indicator from DataCommons...
#> 2021-11-05 13:54:53 INFO::Getting Human Health - Cancer indicator from DataCommons...
#> 2021-11-05 13:54:54 INFO::Getting Human Health - Noncancer indicator from DataCommons...
#> 2021-11-05 13:54:54 INFO::Getting Human Health Toxicity indicator from DataCommons...
#> 2021-11-05 13:54:56 INFO::Getting Human Health - Respiratory Effects indicator from DataCommons...
#> 2021-11-05 13:54:56 INFO::Getting Ozone Depletion indicator from DataCommons...
#> 2021-11-05 13:54:56 INFO::Getting Smog Formation Potential indicator from DataCommons...
#> 2021-11-05 13:54:57 INFO::Getting Freshwater withdrawals indicator from DataCommons...
#> 2021-11-05 13:54:57 INFO::Getting Land use indicator from DataCommons...
#> 2021-11-05 13:54:57 INFO::Getting Hazardous Air Pollutants indicator from DataCommons...
#> 2021-11-05 13:54:57 INFO::Getting Pesticides indicator from DataCommons...
#> 2021-11-05 13:54:57 INFO::Getting Nonrenewable Energy Use indicator from DataCommons...
#> 2021-11-05 13:54:57 INFO::Getting Renewable Energy Use indicator from DataCommons...
#> 2021-11-05 13:54:58 INFO::Getting Energy Use indicator from DataCommons...
#> 2021-11-05 13:54:58 INFO::Getting Minerals and Metals Use indicator from DataCommons...
#> 2021-11-05 13:54:58 INFO::Getting Value Added indicator from useeior...
#> 2021-11-05 13:54:58 INFO::Getting Jobs Supported indicator from useeior...
#> 2021-11-05 13:54:58 INFO::Getting Commercial RCRA Hazardous Waste indicator from useeior...
#> 2021-11-05 13:54:58 INFO::Getting Commercial Municipal Solid Waste indicator from useeior...
#> 2021-11-05 13:54:58 INFO::Getting Commercial Construction and Demolition Debris indicator from useeior...
#> 2021-11-05 13:54:58 INFO::Loading demand vectors from model spec...
#> 2021-11-05 13:54:58 INFO::Loading Consumption demand vector...
#> 2021-11-05 13:54:58 INFO::Loading Production demand vector...
#> 2021-11-05 13:54:58 INFO::Loading HouseholdConsumption demand vector...
#> 2021-11-05 13:54:58 INFO::Loading DomesticConsumption demand vector...
#> 2021-11-05 13:55:01 INFO::Building commodity-by-commodity A matrix (direct requirements)...
#> 2021-11-05 13:55:01 INFO::Building commodity-by-commodity A_d matrix (domestic direct requirements)...
#> 2021-11-05 13:55:01 INFO::Calculating L matrix (total requirements)...
#> 2021-11-05 13:55:01 INFO::Calculating L_d matrix (domestic total requirements)...
#> 2021-11-05 13:55:01 INFO::Building B matrix (direct emissions and resource use per dollar)...
#> 2021-11-05 13:55:03 INFO::Building C matrix (characterization factors for model indicators)...
#> 2021-11-05 13:55:07 INFO::Calculating D matrix (direct environmental impacts per dollar)...
#> 2021-11-05 13:55:07 INFO::Calculating M matrix (total emissions and resource use per dollar)...
#> 2021-11-05 13:55:07 INFO::Calculating M_d matrix (total emissions and resource use per dollar from domestic activity)...
#> 2021-11-05 13:55:07 INFO::Calculating N matrix (total environmental impacts per dollar)...
#> 2021-11-05 13:55:07 INFO::Calculating N_d matrix (total environmental impacts per dollar from domestic activity)...
#> 2021-11-05 13:55:07 INFO::Calculating Rho matrix (price year ratio)...
#> 2021-11-05 13:55:07 INFO::Calculating Phi matrix (producer over purchaser price ratio)...
#> 2021-11-05 13:55:07 INFO::Model build complete.
```

### Validate that commodity output can be recalculated (within 1%) with the model total requirements matrix (L) and demand vector (y) for US production

```r
econval <- compareOutputandLeontiefXDemand(model, tolerance = 0.01)
cat(paste("Number of sectors passing:",econval$N_Pass))
```

Number of sectors passing: 409

```r
cat(paste("Number of sectors failing:",econval$N_Fail))
```

Number of sectors failing: 2

```r
cat(paste("Sectors failing:", paste(econval$Failure$rownames, collapse = ", ")))
```

Sectors failing: S00402/US, S00300/US

### Validate that commodity output can be recalculated (within 1%) with model total domestic requirements matrix (L_d) and model demand (y) for US production

```r
econval <- compareOutputandLeontiefXDemand(model,use_domestic=TRUE, tolerance = 0.01)
cat(paste("Number of sectors passing:",econval$N_Pass))
```

Number of sectors passing: 408

```r
cat(paste("Number of sectors failing:",econval$N_Fail))
```

Number of sectors failing: 3

```r
cat(paste("Sectors failing:", paste(econval$Failure$rownames, collapse = ", ")))
```

Sectors failing: 4200ID/US, S00402/US, S00300/US

### Validate that flow totals by commodity (E_c) can be recalculated (within 1%) using the model satellite matrix (B), market shares matrix (V_n), total requirements matrix (L), and demand vector (y) for US production 

```r
modelval <- compareEandLCIResult(model, tolerance = 0.01)
cat(paste("Number of flow totals by commodity passing:",modelval$N_Pass))
```

Number of flow totals by commodity passing: 1119564

```r
cat(paste("Number of flow totals by commodity failing:",modelval$N_Fail))
```

Number of flow totals by commodity failing: 0

```r
#cat(paste("Sectors failing:", paste(modelval$Failure$variable, collapse = ", ")))
```

### Validate that flow totals by commodity (E_c) can be recalculated (within 1%) using the model satellite matrix (B), market shares matrix (V_n), total domestic requirements matrix (L_d), and demand vector (y) for US production

```r
dom_val <- compareEandLCIResult(model,use_domestic=TRUE, tolerance = 0.01)
cat(paste("Number of flow totals by commodity passing:",dom_val$N_Pass))
```

Number of flow totals by commodity passing: 1119501

```r
cat(paste("Number of flow totals by commodity failing:",dom_val$N_Fail))
```

Number of flow totals by commodity failing: 63

```r
cat(paste("Sectors with flow totals failing:", paste(dom_val$Failure$variable, collapse = ", ")))
```

Sectors with flow totals failing: 4200ID/US, 4200ID/US, 4200ID/US, 4200ID/US, 4200ID/US, 4200ID/US, 4200ID/US, 4200ID/US, 4200ID/US, 4200ID/US, 4200ID/US, 4200ID/US, 4200ID/US, 4200ID/US, 4200ID/US, 4200ID/US, 4200ID/US, 4200ID/US, 4200ID/US, 4200ID/US, 4200ID/US, 4200ID/US, 4200ID/US, 4200ID/US, 4200ID/US, 4200ID/US, 4200ID/US, 4200ID/US, 4200ID/US, 4200ID/US, 4200ID/US, 4200ID/US, 4200ID/US, 4200ID/US, 4200ID/US, 4200ID/US, 4200ID/US, 4200ID/US, 4200ID/US, 4200ID/US, 4200ID/US, 4200ID/US, 4200ID/US, 4200ID/US, 4200ID/US, 4200ID/US, 4200ID/US, 4200ID/US, 4200ID/US, 4200ID/US, 4200ID/US, 4200ID/US, 4200ID/US, 4200ID/US, 4200ID/US, 4200ID/US, 4200ID/US, 4200ID/US, 4200ID/US, 4200ID/US, 4200ID/US, 4200ID/US, 4200ID/US

### Validate that commodity output are properly transformed to industry output via MarketShare

```r
q_x_val <- compareCommodityOutputXMarketShareandIndustryOutputwithCPITransformation(model, tolerance = 0.01)
cat(paste("Number of flow totals by commodity passing:",q_x_val$N_Pass))
```

Number of flow totals by commodity passing: 409

```r
cat(paste("Number of flow totals by commodity failing:",q_x_val$N_Fail))
```

Number of flow totals by commodity failing: 2

```r
cat(paste("Sectors with flow totals failing:", paste(q_x_val$Failure$rownames, collapse = ", ")))
```

Sectors with flow totals failing: S00402/US, S00300/US

### Validate that commodity output equals to domestic use plus production demand

```r
q_val <- compareCommodityOutputandDomesticUseplusProductionDemand(model, tolerance = 0.01)
cat(paste("Number of flow totals by commodity passing:",q_val$N_Pass))
```

Number of flow totals by commodity passing: 409

```r
cat(paste("Number of flow totals by commodity failing:",q_val$N_Fail))
```

Number of flow totals by commodity failing: 2

```r
cat(paste("Sectors with flow totals failing:", paste(q_val$Failure$rownames, collapse = ", ")))
```

Sectors with flow totals failing: 4200ID/US, S00300/US
