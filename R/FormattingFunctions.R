#' Format a dataframe having IO table structure (with just sector code in row and column names) for IOMB process.
#' Change row and column names of the dataframe to "code/names/locationcode".
#' @param IOtable The dataframe, having IO table structure with just sector code, to be formatted.
#' @param model A complete EEIO model: a list with USEEIO model components and attributes.
#' @return A dataframe, having IO table structure, with row and column names from "code" to "code/names/locationcode".
formatIOTableforIOMB <- function (IOtable, model) {
  IndustryCodeName <- model$Industries[, c("Code", "Name")]
  CommodityCodeName <- model$Commodities[, c("Code", "Name")]
  # Determine whether it is Industry/Commodity in IOtable row/column
  # Modify IOtable row and column names
  if (length(unique(rownames(IOtable)%in%IndustryCodeName$Code)) == 1) {
    # Row name is Industry
    IndustryCodeName <- IndustryCodeName[IndustryCodeName$Code%in%rownames(IOtable), ]
    IndustryCodeName <- IndustryCodeName[order(factor(IndustryCodeName$Code, levels = rownames(IOtable))), ]
    rownames(IOtable) <- tolower(paste(rownames(IOtable), IndustryCodeName[, 2], "US", sep = "/"))
  } else {
    # Row name is Commodity
    CommodityCodeName <- CommodityCodeName[CommodityCodeName$Code%in%rownames(IOtable), ]
    CommodityCodeName <- CommodityCodeName[order(factor(CommodityCodeName$Code, levels = rownames(IOtable))), ]
    rownames(IOtable) <- tolower(paste(rownames(IOtable), CommodityCodeName[, 2], "US", sep = "/"))
  }
  if (length(unique(colnames(IOtable)%in%IndustryCodeName$Code)) == 1) {
    # Column name is Industry
    IndustryCodeName <- IndustryCodeName[IndustryCodeName$Code%in%colnames(IOtable), ]
    IndustryCodeName <- IndustryCodeName[order(factor(IndustryCodeName$Code, levels = colnames(IOtable))), ]
    colnames(IOtable) <- tolower(paste(colnames(IOtable), IndustryCodeName[, 2], "US", sep = "/"))
  } else {
    # Column name is Commodity
    CommodityCodeName <- CommodityCodeName[CommodityCodeName$Code%in%colnames(IOtable), ]
    CommodityCodeName <- CommodityCodeName[order(factor(CommodityCodeName$Code, levels = colnames(IOtable))), ]
    colnames(IOtable) <- tolower(paste(colnames(IOtable), CommodityCodeName[, 2], "US", sep = "/"))
  } 
  # Need code here to format state IO tables

  return(IOtable)
}

#' Format a dataframe having LCIA table structure for IOMB process.
#' Change row names of the dataframe to "code/names/locationcode".
#' @param model A complete EEIO model: a list with USEEIO model components and attributes.
#' @return A dataframe, having LCIA table structure, with row names from "code" to "code/names/locationcode".
formatLCIAforIOMB <- function(model) {
  # Generate LCIA table
  lcia <- generateLCIA(model)
  # Load standard LCIA fields for IOMB
  lciafields <- configr::read.config(system.file("extdata/IOMB_Fields.yml", package="useeior"))[["LCIA"]]
  # Change column names to match those in IOMB format
  colnames(lcia) <- c("Code", "Flowable", "Flow-UUID", "Context", "Unit", "Amount",
                      "Index", "ID", "Name", "Ref.Unit", "Group", "SimpleUnit","SimpleName")
  # Add LCIA-Method column
  lcia[, "LCIA-Method"] <- "USEEIO-LCIA"
  # format to meet IOMB format
  formattedlcia <- lcia[, lciafields]
  return(formattedlcia)
}

#' Format the sector meta data of a model for IOMB process.
#' @param model A complete EEIO model: a list with USEEIO model components and attributes.
#' @return A dataframe, having sector meta data table structure, with column names required by IOMB. 
formatSectorMetaDataforIOMB <- function (model) {
  if (model$specs$CommoditybyIndustryType=="Commodity") {
    sectormetadata <- model$Commodities[, c("Code", "Name")]
  } else {
    sectormetadata <- model$Industries[, c("Code", "Name")]
  }
  sectormetadata[, c("Category",	"Sub-category")] <- ""
  sectormetadata$Location <- model$specs$PrimaryRegionAcronym
  sectormetadata$Description <- ""
  return(sectormetadata)
}

#'Formats the location by appending "US-" before models
#'@param r, string of region name
#'@return r, "US-r"
formatLocationforStateModels <- function(r){
  r <- paste0("US-", r)
  return(r)
}
